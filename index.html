<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario con Lotes</title>

<style>
body{
    font-family: Arial;
    margin:0;
    background:#f4f4f4;
}

header{
    background:#222;
    color:white;
    padding:15px;
    text-align:center;
}

#alertas{
    background:#ffdddd;
    padding:10px;
    font-size:14px;
}

.container{
    padding:15px;
}

input, button{
    padding:8px;
    margin:5px 0;
}

.producto{
    background:white;
    padding:10px;
    margin-top:10px;
    border-radius:6px;
    box-shadow:0 0 5px rgba(0,0,0,0.1);
}

.lote{
    background:#f9f9f9;
    padding:6px;
    margin-top:5px;
    border-left:4px solid #2196F3;
}
</style>
</head>

<body>

<header>
<h2>Mi Inventario</h2>
</header>

<div id="alertas"></div>

<div class="container">

<h3>Agregar Producto</h3>

<input type="text" id="nombreProducto" placeholder="Nombre del producto">
<input type="date" id="fechaLote">
<button onclick="agregarProducto()">Agregar</button>

<div id="listaProductos"></div>

</div>

<script>

let productos = JSON.parse(localStorage.getItem("inventario")) || [];

function guardarLocal(){
    localStorage.setItem("inventario", JSON.stringify(productos));
}

function agregarProducto(){
    let nombre = document.getElementById("nombreProducto").value;
    let fecha = document.getElementById("fechaLote").value;

    if(nombre === "" || fecha === ""){
        alert("Completa los datos");
        return;
    }

    let nuevoProducto = {
        nombre: nombre,
        lotes: [
            {
                numero: 1,
                fecha: fecha
            }
        ]
    };

    productos.push(nuevoProducto);
    guardarLocal();
    mostrarProductos();
}

function agregarLote(index){
    let fecha = prompt("Ingrese fecha del nuevo lote (YYYY-MM-DD)");
    if(!fecha) return;

    let producto = productos[index];
    let numeroLote = producto.lotes.length + 1;

    producto.lotes.push({
        numero: numeroLote,
        fecha: fecha
    });

    guardarLocal();
    mostrarProductos();
}

function mostrarProductos(){
    let contenedor = document.getElementById("listaProductos");
    contenedor.innerHTML = "";

    productos.forEach((producto, index) => {

        let div = document.createElement("div");
        div.className = "producto";

        div.innerHTML = `
            <strong>${producto.nombre}</strong>
            <button onclick="agregarLote(${index})">Agregar Lote</button>
        `;

        producto.lotes.forEach(lote => {
            let loteDiv = document.createElement("div");
            loteDiv.className = "lote";
            loteDiv.innerHTML = `
                Lote ${lote.numero} - Vence: ${lote.fecha}
            `;
            div.appendChild(loteDiv);
        });

        contenedor.appendChild(div);
    });

    verificarAlertas();
}

function verificarAlertas(){
    let hoy = new Date();
    let alertaDiv = document.getElementById("alertas");
    alertaDiv.innerHTML = "";

    productos.forEach(producto => {
        producto.lotes.forEach(lote => {
            let fechaV = new Date(lote.fecha);
            let diferencia = (fechaV - hoy) / (1000 * 60 * 60 * 24);

            if(diferencia <= 7){
                alertaDiv.innerHTML += `
                âš  ${producto.nombre} - Lote ${lote.numero} vence pronto (${lote.fecha})<br>
                `;
            }
        });
    });
}

mostrarProductos();

</script>

</body>
</html>
