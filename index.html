<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario Pro</title>

<style>
body{
    font-family: Arial;
    margin:0;
    background:#f4f4f4;
}

header{
    background:#111;
    color:white;
    padding:15px;
    text-align:center;
}

#alertas{
    background:#ffe0e0;
    padding:10px;
    font-size:14px;
}

.container{
    padding:15px;
}

input, button{
    padding:6px;
    margin:4px 0;
}

button{
    cursor:pointer;
}

.producto{
    background:white;
    padding:10px;
    margin-top:12px;
    border-radius:6px;
    box-shadow:0 0 5px rgba(0,0,0,0.1);
}

.lote{
    background:#f9f9f9;
    padding:6px;
    margin-top:5px;
    border-left:4px solid #2196F3;
}

.eliminar{
    background:red;
    color:white;
    border:none;
    padding:4px 6px;
    font-size:12px;
}
</style>
</head>

<body>

<header>
<h2>Inventario Completo</h2>
</header>

<div id="alertas"></div>

<div class="container">

<h3>Agregar Producto</h3>

<input type="text" id="nombreProducto" placeholder="Nombre del producto"><br>

<input type="number" id="precioCompra" placeholder="Precio compra"><br>
<input type="number" id="precioVenta" placeholder="Precio venta"><br>
<input type="number" id="precioMayor" placeholder="Precio por mayor"><br>

<input type="date" id="fechaLote"><br>

<button onclick="agregarProducto()">Agregar Producto</button>

<div id="listaProductos"></div>

</div>

<script>

let productos = JSON.parse(localStorage.getItem("inventario")) || [];

function guardarLocal(){
    localStorage.setItem("inventario", JSON.stringify(productos));
}

function agregarProducto(){

    let nombre = document.getElementById("nombreProducto").value;
    let compra = parseFloat(document.getElementById("precioCompra").value);
    let venta = parseFloat(document.getElementById("precioVenta").value);
    let mayor = parseFloat(document.getElementById("precioMayor").value);
    let fecha = document.getElementById("fechaLote").value;

    if(!nombre || !compra || !venta || !mayor || !fecha){
        alert("Completa todos los campos");
        return;
    }

    let nuevoProducto = {
        nombre: nombre,
        precioCompra: compra,
        precioVenta: venta,
        precioMayor: mayor,
        costoUnidad: compra,
        costoDocena: compra * 12,
        lotes: [
            {
                numero: 1,
                fecha: fecha
            }
        ]
    };

    productos.push(nuevoProducto);
    guardarLocal();
    mostrarProductos();
}

function agregarLote(index){

    let fecha = prompt("Ingrese fecha del nuevo lote (YYYY-MM-DD)");
    if(!fecha) return;

    let producto = productos[index];
    let numeroLote = producto.lotes.length + 1;

    producto.lotes.push({
        numero: numeroLote,
        fecha: fecha
    });

    guardarLocal();
    mostrarProductos();
}

function eliminarProducto(index){
    if(confirm("¿Eliminar producto completo?")){
        productos.splice(index,1);
        guardarLocal();
        mostrarProductos();
    }
}

function eliminarLote(indexProducto,indexLote){
    if(confirm("¿Eliminar este lote?")){
        productos[indexProducto].lotes.splice(indexLote,1);
        guardarLocal();
        mostrarProductos();
    }
}

function mostrarProductos(){

    let contenedor = document.getElementById("listaProductos");
    contenedor.innerHTML = "";

    productos.forEach((producto, index) => {

        let div = document.createElement("div");
        div.className = "producto";

        div.innerHTML = `
            <strong>${producto.nombre}</strong><br>
            Compra: S/ ${producto.precioCompra}<br>
            Venta: S/ ${producto.precioVenta}<br>
            Mayor: S/ ${producto.precioMayor}<br>
            Costo Unidad: S/ ${producto.costoUnidad}<br>
            Costo Docena: S/ ${producto.costoDocena}<br>
            <button onclick="agregarLote(${index})">Agregar Lote</button>
            <button class="eliminar" onclick="eliminarProducto(${index})">Eliminar Producto</button>
        `;

        producto.lotes.forEach((lote, i) => {

            let loteDiv = document.createElement("div");
            loteDiv.className = "lote";

            loteDiv.innerHTML = `
                Lote ${lote.numero} - Vence: ${lote.fecha}
                <button class="eliminar" onclick="eliminarLote(${index},${i})">X</button>
            `;

            div.appendChild(loteDiv);
        });

        contenedor.appendChild(div);
    });

    verificarAlertas();
}

function verificarAlertas(){

    let hoy = new Date();
    let alertaDiv = document.getElementById("alertas");
    alertaDiv.innerHTML = "";

    productos.forEach(producto => {
        producto.lotes.forEach(lote => {

            let fechaV = new Date(lote.fecha);
            let diferencia = (fechaV - hoy) / (1000 * 60 * 60 * 24);

            if(diferencia <= 7){
                alertaDiv.innerHTML += `
                ⚠ ${producto.nombre} - Lote ${lote.numero} vence pronto (${lote.fecha})<br>
                `;
            }
        });
    });
}

mostrarProductos();

</script>

</body>
</html>
